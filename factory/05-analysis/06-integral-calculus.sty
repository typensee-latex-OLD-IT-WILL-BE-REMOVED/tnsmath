% == PACKAGES USED == %

\RequirePackage{amsmath}
\RequirePackage{relsize}
\RequirePackage{xstring}


% == DEFINITIONS == %

% Source for minimizing spaces between consecutive integrals :
%    * http://forum.mathematex.net/latex-f6/integrale-triple-t13312.html#p128016

% Consecutive integrals

\let\stdint\int
\DeclareRobustCommand{\int}{%
    \stdint\operator@followup{\@ifnextchar{\int}{\!\!}{}}%
}

\def\operator@followup#1{%
    \@ifnextchar{^}{\operator@followup@sup{#1}}%
        {\operator@followup@nosup{#1}}%
}

\def\operator@followup@sup#1^#2{%
    \@ifnextchar{_}{\operator@followup@sup@sub{#1}^{#2}}%
        {\operator@followup@sup@nosub{#1}^{#2}}%
}

\def\operator@followup@sup@sub#1^#2_#3{%
    \operator@followup@{#1}{#2}{#3}%
}

\def\operator@followup@sup@nosub#1^#2{%
    \operator@followup@{#1}{#2}{}%
}

\def\operator@followup@nosup#1{%
    \@ifnextchar{_}{\operator@followup@nosup@sub{#1}}
        {\operator@followup@nosup@nosub{#1}}%
}

\def\operator@followup@nosup@sub#1_#2{%
    \@ifnextchar{^}{\operator@followup@nosup@sub@sup{#1}_{#2}}
        {\operator@followup@nosup@sub@nosup{#1}_{#2}}%
}

\def\operator@followup@nosup@sub@sup#1_#2^#3{%
    \operator@followup@{#1}{#3}{#2}%
}

\def\operator@followup@nosup@sub@nosup#1_#2{%
    \operator@followup@{#1}{}{#2}%
}

\def\operator@followup@nosup@nosub#1{%
    \operator@followup@{#1}{}{}%
}

\def\operator@followup@#1#2#3{%
    ^{#2}_{#3}#1%
}


% Integration

\newcommand\integrate{\@ifstar{\@integrate@star}{\@integrate@no@star}}

\newcommand\@integrate@star[4]{%
	\int_{#1}^{#2} #3 \dd{#4}%
}

\newcommand\@integrate@no@star[4]{%
	\@integrate@star{#4\,=\,#1}{#4\,=\,#2}{#3}{#4}%
}


\newcommand\dintegrate{\@ifstar{\@dintegrate@star}{\@dintegrate@no@star}}

\newcommand\@dintegrate@star[4]{%
	{\displaystyle\integrate*{#1}{#2}{#3}{#4}}%
}

\newcommand\@dintegrate@no@star[4]{%
	{\displaystyle\integrate{#1}{#2}{#3}{#4}}%
}


% The hook operator

\newcommand\@hook@small@vertical@phantom[1]{%
	\vphantom{\text{\relsize{1.1}$#1$}}%
}

\newcommand\@hook@big@vertical@phantom{%
	\vphantom{\relsize{1.25}{\text{$\displaystyle F_1^2$}}}%
}

\newcommand\@abstract@hook[4][b]{%
    \IfEqCase{#1}{%
        {b}{%
			\left[%
				\@hook@small@vertical@phantom{#4}%
				\,#4\,%
			\right]%
        }{sb}{%
			\left[%
				\@hook@big@vertical@phantom \right. \!\!%
				\,#4\,%
				\left. \@hook@big@vertical@phantom \!\!%
			\right]%
        }{r}{%
            \left. #4\, \right\rvert%
        }{sr}{%
            #4\, {\text{\relsize{1.5}$\rvert$}}%
        }%
    }[
    	\PackageError{lymath}{unknown option}%
                             {You can use b (default), sb, r or sr.}
    ]%
	_{\,#2}^{\,#3}%
}


\newcommand\hook{\@ifstar{\@hook@star}{\@hook@no@star}}

\newcommand\@hook@star[5][b]{%
	\@abstract@hook[#1]{#2}{#3}{#4}%
}

\newcommand\@hook@no@star[5][b]{%
	\@abstract@hook[#1]{#5\,=\,#2}{#5\,=\,#3}{#4}%
}
