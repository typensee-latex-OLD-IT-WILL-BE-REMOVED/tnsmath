\documentclass[12pt,a4paper]{article}

\makeatletter
    \input{../config/header[fr].sty}
    \input{../01-misc/00-common-tools.sty}

    \usepackage{04-calculations-explained}
\makeatother


\newcommand\RRp{RR+}
\newcommand\vimplies{\Downarrow}
\newcommand\viff{\Updownarrow}


\begin{document}

%\section{Logique et fondements}

\subsection{Détailler un raisonnement -- Version pour le lycée et après} \label{explain-proof}

\paragraph{Exemple 1 -- Avec les réglages par défaut}

L'environnement \env{explain} permet de détailler les étapes principales d'un calcul ou d'un raisonnement en s'appuyant sur la macro \macro{explnext} dont le nom vient de \emph{\og \whyprefix{expl}{ain} \prefix{next} step \fg} soit \inenglish{expliquer la prochaine étape}
\footnote{
    Le gros du travail est fait par l'environnement \env{flalign} du package \texttt{amsmath} qui est automatiquement chargé par \texttt{lymath}.
}.
Voici un exemple avec les réglages par défaut où \macro{explnext*} permet d'utiliser deux lignes au lieu d'une seule
\footnote{
    Les explications données ne doivent pas être trop longues car ce serait contre productif.
    Avec deux lignes on peut distinguer une phase montante et une autre descendante.
}.
Notons au passage que ce type de présentation n'est sûrement pas bien adaptée à un jeune public pour lequel une 2\ieme{} façon de détailler des calculs ou un raisonnement est proposée dans la section \ref{explain-proof-for-youngs} un peu plus bas.

\begin{latexex-flat}
\begin{explain}
    (a + b)^2
        \explnext{On utilise $x^2 = x \cdot x$.}
    (a + b) (a + b)
        \explnext*{$\Downarrow$ Double développement depuis la parenthèse gauche.}%
                  {$\Uparrow$ Double factorisation non nécessairement évidente.}
    a^2 + a b + b a + b^2
        \explnext{Commutativité du produit.}
    a^2 + 2 a b + b^2
\end{explain}
\end{latexex-flat}


\begin{remark}
    La macro \macro{explnext} utilise les macros constantes suivantes.
    \begin{itemize}
        \item \macro{textexplainleft} et \macro{textexplainright} qui donnent $\textexplainleft$ et $\textexplainright$ respectivement par défaut.

        \item \macro{textexplainspacein} est l'espacement entre le symbole et la courte explication. Par défaut, cette macro vaut \verb+2em+.
    \end{itemize}
\end{remark}


% ---------------------- %


\paragraph{Exemple 2 -- Utiliser un autre symbole globalement}

L'environnement \env{explain} possède un argument optionnel qui est \verb+=+ par défaut. Ceci permet de faire ce qui suit sans effort.

\begin{latexex}
\begin{explain}[\viff]
    x^2 + 10 x + 25 = 0
        \explnext{Identité remarquable.}
    (x + 5)^2 = 0
        \explnext{$P^2 = 0$ si et 
                  seulement si $P = 0$.}
    x = -5
\end{explain}
\end{latexex}


% ---------------------- %


\paragraph{Exemple 3 -- Juste utiliser des symboles}

Si l'argument obligatoire de la macro \macro{explnext} est vide alors seul le symbole est affiché \emph{(ne pas oublier les accolades vides)}. Voici un court exemple de ceci.

\begin{latexex}
\begin{explain}[\viff]
    a^2 = b^2
        \explnext{}
    a = \pm b
\end{explain}
\end{latexex}


%% ---------------------- %


\paragraph{Exemple 4 -- Utiliser un autre symbole localement}

La macro \macro{explnext} possède un argument optionnel qui utilise par défaut celui de l'environment. En utilisant cette option, on choisit alors localement le symbole à employer. Voici un exemple d'utilisation complètement farfelu bien que correct.

\begin{latexex}
\begin{explain}[\viff]
    0 \leq a < b
        \explnext[\vimplies]%
                 {Croissance de $x^2$ 
                  sur $\RRp$.}
    a^2 < b^2
        \explnext{}
    a^2 - b^2 < 0
        \explnext{Identité remarquable.}
    (a - b)(a + b) < 0
        \explnext[\vimplies]{}
    a \neq b
\end{explain}
\end{latexex}


% ---------------------- %


\subsubsection{Fiches techniques}

\paragraph{Les textes pour détailler un raisonnement -- Version pour le lycée et après} \label{step-by-step-texts}

\IDmacro*{textexplainleft}{0}

\IDmacro*{textexplainright}{0}

\IDmacro*{textexplainspacein}{0}


% ---------------------- %


\paragraph{Détailler un raisonnement -- Version pour le lycée et après} \label{step-by-step-university} 

\IDenv{explain}{1}

\IDoption{} le symbole à utiliser dans l'environnement, la valeur par défaut étant \verb+=+ .


\separation


\IDmacro{explnext}{1}{1} où \quad \mwhyprefix{expl}{ain}

\IDoption{} le symbole à utiliser pour une explication, la valeur par défaut étant celle du symbole de l'environnement \env{explain} où \macro{explnext} est utilisé.

\IDarg{} le texte de l'explication qui peut être vide si aucune explication n'est à afficher.


\separation


\IDmacro{explnext*}{1}{2} où \quad \mwhyprefix{expl}{ain}

\IDoption{} le symbole à utiliser pour une explication, la valeur par défaut étant celle du symbole de l'environnement \env{explain} où \macro{explnext} est utilisé.

\IDarg{1} le texte de l'explication pour la 1\iere{} ligne.
          Ce texte peut être vide \emph{(voir l'environnement \env{aexplain} pour la raison de ceci)}.

\IDarg{2} le texte de l'explication pour la 2\ieme{} ligne.
          Ce texte peut être vide \emph{(voir l'environnement \env{aexplain} pour la raison de ceci)}.


% ---------------------- %


\subsection{Détailler un raisonnement -- Version pour les collégiens} \label{explain-proof-for-youngs}

L'environnement \env{aexplain}
\footnote{
    Cet environnement utilise le package \texttt{witharrows} qui est très sympathique pour expliquer des étapes de calcul.
}
utilise des flèches pour indiquer les explications
\emph{(\prefix{a} est pour \whyprefix{a}{rrow} soit \inenglish{flèche})}.
Son fonctionnement est similaire à celui de \env{explain} si ce n'est que la macro \macro{explnext*} permet d'avoir une flèche unidirectionnelle, vers le haut ou le bas au choix, ou bien d'écrire deux indications dont l'une est montante et l'autre descendante.

\medskip

Il existe aussi l'environnement \env{aexplain*} lorsque la toute 1\iere{} étape n'est pas expliquée.
Par contre ceci nécessite au tout début de l'environnement l'usage de la macro très spéciale \macro{explsymb}.


% ---------------------- %


\paragraph{Exemple 1 -- Flèche à double sens ou sans flèche}

\begin{latexex}
\begin{aexplain}
    (a + b)^2 
        \explnext{Identité remarquable}
    a^2 + 2 a b + b^2
        \explnext{}
    a^2 + b^2 + 2 a b
\end{aexplain}
\end{latexex}


% ---------------------- %


\paragraph{Exemple 2 -- Des flèches unidirectionnelles}

Ce qui suit est juste là comme démo. car les explications y sont un peu farfelues.

\begin{latexex-flat}
\begin{aexplain}
    (a + b) (a + b)
        \explnext*{Double développement.}%
                  {Double factorisation (pas simple).}
    a^2 + a b + b a + b^2
        \explnext*{Commutativité du produit.}%
                  {}
    a^2 + 2 a b + b^2
        \explnext*{}%
                  {Commutativité de l'addition.}
    a^2 + b^2 + 2 a b
\end{aexplain}
\end{latexex-flat}


% ---------------------- %


\paragraph{Exemple 3 -- Ne pas expliquer le tout début}

Ci-dessous, la macro \macro{explsymb} n'est à utiliser qu'une seule fois !

\begin{latexex-flat}
\begin{aexplain*}
    (a + b) (a + b)
        \explsymb{}
    (a + b)^2
        \explnext{Identité remarquable.}
    a^2 + b^2 + 2 a b
\end{aexplain*}
\end{latexex-flat}

% ---------------------- %


\paragraph{Exemple 4 -- Choisir son symbole}

Voici comment faire avec la version non étoilée.

\begin{latexex}
\begin{aexplain}[\iff]
    a^2 + 2 a b + b^2 = 0
        \explnext{}
    (a + b)^2 = 0
        \explnext{$P^2 = 0$ ssi $P = 0$.}
    a + b = 0
\end{aexplain}
\end{latexex}


Avec la version étoilée, on obtient ce qui suit.

\begin{latexex-flat}
\begin{aexplain*}[\iff]
    a^2 + 2 a b + b^2 = 0
        \explsymb{}
    (a + b)^2 = 0
        \explnext{$P^2 = 0$ ssi $P = 0$.}
    a + b = 0
\end{aexplain*}
\end{latexex-flat}


% ---------------------- %


\paragraph{Exemple 6 -- Un mini hack très utile}

Vous pouvez écrire très facilement des calculs alignés comme suit sans trop vous fatiguez \emph{(chacune des trois solutions présentées laisse toujours la possibilité d'expliquer une étape intermédiaire après coup)}.

\begin{latexex}
\begin{aexplain*}
    (a + b) (a + b)
        \explsymb{}
    (a + b)^2
        \explnext{}
    a^2 + b^2 + 2 a b
        \explnext{}
    a^2 + 2 a b + b^2
\end{aexplain*}
\end{latexex}

On a accès à une autre mise en forme \emph{(ceci peut rendre aussi service)}. 

\begin{latexex}
\begin{aexplain}
    (a + b) (a + b)
        \explnext{}
    (a + b)^2
        \explnext{}
    a^2 + b^2 + 2 a b
        \explnext{}
    a^2 + 2 a b + b^2
\end{aexplain}
\end{latexex}

Enfin dans le cadre de calculs à faire expliquer par des élèves, ce qui suit peut être utile.

\begin{latexex}
\begin{explain}
    (a + b) (a + b)
        \explnext{}
    (a + b)^2
        \explnext{}
    a^2 + b^2 + 2 a b
        \explnext{}
    a^2 + 2 a b + b^2
\end{explain}
\end{latexex}


% ---------------------- %

\subsubsection{Fiches techniques}

\paragraph{Détailler un raisonnement -- Version pour les collégiens}

Voir les macros
\macro{textexplainleft},
\macro{textexplainright},
\macro{textexplainspacein},
\macro{explnext} ainsi que
\macro{explnext*}
dans les sections \ref{step-by-step-texts} et \ref{step-by-step-university}.

\separation

\IDenv{aexplain}{1}  où \quad \mwhyprefix{a}{rrow}

\IDenv{aexplain*}{1}  où \quad \mwhyprefix{a}{rrow}

\IDoption{} le symbole à utiliser dans l'environnement, la valeur par défaut étant \verb+=+ .


\separation

\IDmacro*{explsymb}{0}

\extraspace

\emph{\textbf{ATTENTION !} Cette macro n'est utilisable qu'au début de l'environnement \env{aexplain*}.}
\end{document}
