% ----------------------- %
% -- PACKAGES REQUIRED -- %
% ----------------------- %

\RequirePackage{amsmath}
\RequirePackage{amssymb}
\RequirePackage{bm}
\RequirePackage{dsfont}
\RequirePackage[f]{esvect}
\RequirePackage{graphicx}
\RequirePackage{ifmtarg}
\RequirePackage{mathrsfs}
\RequirePackage{mathtools}
\RequirePackage{relsize}
\RequirePackage{stmaryrd}
\RequirePackage[Symbolsmallscale]{upgreek}
\RequirePackage{xstring}
\RequirePackage{yhmath}


% ------------------------------------------- %
% -- MISCELLANEOUS - SEMI COLON AND SPACES -- %
% ------------------------------------------- %

% Sources :
%    * http://forum.mathematex.net/latex-f6/espacement-autour-des-points-virgules-en-mode-maths-t8379.html#p83226
%    * http://forum.mathematex.net/latex-f6/espace-autour-d-un-point-virgule-en-mode-maths-t12323.html#p119334

% This command is adapted from the one given in the following link fro factorial :
% http://www.math.bme.hu/latex/magyar_pre_tug2004.pdf#page=28

\makeatletter 
    \@ifpackagewith{babel}{francais}{
        \def\fixmathspacing#1#2#3{%
            \def#1{#3}%
            \expandafter\addto\csname \expandafter
            \ifx\csname mathoptions@on\endcsname\relax% detect nath.sty
                check@mathfonts%
            \else
                mathoptions@on%
            \fi
            \endcsname{%
                \catcode`#212 \mathcode`#2"8000
                \begingroup\lccode`~`#2\lowercase{\endgroup\def~}{#1}
            }
        }
    
    	\fixmathspacing{\fixedsemicolon}{;}{\mathclose{}\mathpunct{}\mathpunct{\mathchar"603B}}
    }{}
\makeatother


% -------------------- %
% -- SETS - GENERAL -- %
% -------------------- %

% Source for mathpzc : page 68 de ''The Comprehensive LATEX Symbol List''


% Only the upper case letters

\makeatletter

	\newcommand\probaset[1]{
    	\IfSubStr{,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,}{,#1,}{
        	\mathcal{#1}
    	}{%
        	\PackageError{lymath}{Command << probaset >> only accepts single upper case letters}%
    	}
	}

% With ''mathscr'', we only have the upper case letters.
% So we use the following trick for lower case letters.

	\DeclareMathAlphabet{\mathpzc}{OT1}{pzc}{m}{it}

	\newcommand\geoset[1]{
	    \IfSubStr{,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,}{,#1,}{
        	\mathscr{#1}
    	}{%
	        \IfSubStr{,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,}{,#1,}{
        	    \mathpzc{#1}
    	    }{%
	            \PackageError{lymath}{Command << fieldset >> only accepts single h, k or upper case letter}%
        	}
    	}
	}


% Only the upper case letters and also h and k.
%
% With ''\mathbb'', there are only the upper case letters.

	\newcommand\fieldset[1]{
    	\IfSubStr{,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,h,k,}{,#1,}{
    	    \mathds{#1}
    	}{%
        	\PackageError{lymath}{Command << fieldset >> only accepts letters h or k alone, and upper case letters}%
    	}
	}


	\newcommand\setpos{\text{\bf{\tiny+}}}
	\newcommand\setneg{\vphantom{\setpos}-}
	\newcommand\setstar{\text{*}}


    \newcommand\specialset{\@ifstar{\@specialsetStar}{\@specialsetNoStar}}

    \newcommand\@specialsetNoStar[2]{
        \IfEqCase{#2}{
            {s}{ #1^{\setstar} }
            {n}{ #1^{\phantom{\setstar}}_{\setneg} }
            {p}{ #1^{\phantom{\setstar}}_{\setpos} }
            {sn}{ #1^{\setstar}_{\setneg} }
            {sp}{ #1^{\setstar}_{\setpos} }
        }
    }

    \newcommand\@specialsetStar[2]{
        \IfEqCase{#2}{
            {s}{ #1_{\neq 0} }
            {n}{ #1_{\le 0} }
            {p}{ #1_{\ge 0} }
            {sn}{ #1_{< 0} }
            {sp}{ #1_{> 0} }
        }
    }
\makeatother

% The empty set

\newcommand\nullset{\ensuremath{\text{\scalebox{1.2}{$\varnothing$}}}}

% List of classical sets

\newcommand\NN{\ensuremath{\fieldset{N}}}
\newcommand\NNs{\ensuremath{\specialset{\NN}{s}}}

\newcommand\ZZ{\ensuremath{\fieldset{Z}}}
\newcommand\ZZp{\ensuremath{\specialset{\ZZ}{p}}}
\newcommand\ZZn{\ensuremath{\specialset{\ZZ}{n}}}
\newcommand\ZZs{\ensuremath{\specialset{\ZZ}{s}}}
\newcommand\ZZsn{\ensuremath{\specialset{\ZZ}{sn}}}
\newcommand\ZZsp{\ensuremath{\specialset{\ZZ}{sp}}}

\newcommand\DD{\ensuremath{\fieldset{D}}}
\newcommand\DDp{\ensuremath{\specialset{\DD}{p}}}
\newcommand\DDn{\ensuremath{\specialset{\DD}{n}}}
\newcommand\DDs{\ensuremath{\specialset{\DD}{s}}}
\newcommand\DDsn{\ensuremath{\specialset{\DD}{sn}}}
\newcommand\DDsp{\ensuremath{\specialset{\DD}{sp}}}

\newcommand\QQ{\ensuremath{\fieldset{Q}}}
\newcommand\QQp{\ensuremath{\specialset{\QQ}{p}}}
\newcommand\QQn{\ensuremath{\specialset{\QQ}{n}}}
\newcommand\QQs{\ensuremath{\specialset{\QQ}{s}}}
\newcommand\QQsn{\ensuremath{\specialset{\QQ}{sn}}}
\newcommand\QQsp{\ensuremath{\specialset{\QQ}{sp}}}

\newcommand\RR{\ensuremath{\fieldset{R}}}
\newcommand\RRp{\ensuremath{\specialset{\RR}{p}}}
\newcommand\RRn{\ensuremath{\specialset{\RR}{n}}}
\newcommand\RRs{\ensuremath{\specialset{\RR}{s}}}
\newcommand\RRsn{\ensuremath{\specialset{\RR}{sn}}}
\newcommand\RRsp{\ensuremath{\specialset{\RR}{sp}}}

\newcommand\CC{\ensuremath{\fieldset{C}}}
\newcommand\CCs{\ensuremath{\specialset{\CC}{s}}}

\newcommand\HH{\ensuremath{\fieldset{H}}}
\newcommand\HHs{\ensuremath{\specialset{\HH}{s}}}

\newcommand\OO{\ensuremath{\fieldset{O}}}
\newcommand\OOs{\ensuremath{\specialset{\OO}{s}}}


% ---------------------- %
% -- SETS - INTERVALS -- %
% ---------------------- %

\makeatletter
    \newcommand\@interToolNoStar[4]{%
    	\ensuremath{ \left#1 \vphantom{\relsize{1.25}{\text{$\displaystyle F_1^2$}}} \right. \!\! #2 ; #3 \left. \vphantom{\relsize{1.25}{\text{$\displaystyle F_1^2$}}} \!\! \right#4}%
	}

    \newcommand\@interToolStar[4]{\ensuremath{ \left#1 #2 \, ; #3 \right#4}}
 
   
% Macros for intervals - START

% Macros for french real intervals

    \newcommand\intervalCO{\@ifstar{\@intervalCOStar}{\@intervalCONoStar}}
    \newcommand\@intervalCONoStar[2]{\ensuremath{\@interToolNoStar{[}{#1}{#2}{[}}}
    \newcommand\@intervalCOStar[2]{\ensuremath{\@interToolStar{[}{#1}{#2}{[}}}

    \newcommand\intervalC{\@ifstar{\@intervalCStar}{\@intervalCNoStar}}
    \newcommand\@intervalCNoStar[2]{\ensuremath{\@interToolNoStar{[}{#1}{#2}{]}}}
    \newcommand\@intervalCStar[2]{\ensuremath{\@interToolStar{[}{#1}{#2}{]}}}

    \newcommand\intervalO{\@ifstar{\@intervalOStar}{\@intervalONoStar}}
    \newcommand\@intervalONoStar[2]{\ensuremath{\@interToolNoStar{]}{#1}{#2}{[}}}
    \newcommand\@intervalOStar[2]{\ensuremath{\@interToolStar{]}{#1}{#2}{[}}}

    \newcommand\intervalOC{\@ifstar{\@intervalOCStar}{\@intervalOCNoStar}}
    \newcommand\@intervalOCNoStar[2]{\ensuremath{\@interToolNoStar{]}{#1}{#2}{]}}}
    \newcommand\@intervalOCStar[2]{\ensuremath{\@interToolStar{]}{#1}{#2}{]}}}

% Macros for american real intervals

    \newcommand\intervalCP{\@ifstar{\@intervalCPStar}{\@intervalCPNoStar}}
    \newcommand\@intervalCPNoStar[2]{\ensuremath{\@interToolNoStar{[}{#1}{#2}{)}}}
    \newcommand\@intervalCPStar[2]{\ensuremath{\@interToolStar{[}{#1}{#2}{)}}}

    \newcommand\intervalP{\@ifstar{\@intervalPStar}{\@intervalPNoStar}}
    \newcommand\@intervalPNoStar[2]{\ensuremath{\@interToolNoStar{(}{#1}{#2}{)}}}
    \newcommand\@intervalPStar[2]{\ensuremath{\@interToolStar{(}{#1}{#2}{)}}}

    \newcommand\intervalPC{\@ifstar{\@intervalPCStar}{\@intervalPCNoStar}}
    \newcommand\@intervalPCNoStar[2]{\ensuremath{\@interToolNoStar{(}{#1}{#2}{]}}}
    \newcommand\@intervalPCStar[2]{\ensuremath{\@interToolStar{(}{#1}{#2}{]}}}

% Macros for discrete intervals

    \newcommand\ZintervalCO{\@ifstar{\@ZintervalCOStar}{\@ZintervalCONoStar}}
    \newcommand\@ZintervalCONoStar[2]{\ensuremath{\@interToolNoStar{\llbracket}{#1}{#2}{\llbracket}}}
    \newcommand\@ZintervalCOStar[2]{\ensuremath{\@interToolStar{\llbracket}{#1}{#2}{\llbracket}}}

    \newcommand\ZintervalC{\@ifstar{\@ZintervalCStar}{\@ZintervalCNoStar}}
    \newcommand\@ZintervalCNoStar[2]{\ensuremath{\@interToolNoStar{\llbracket}{#1}{#2}{\rrbracket}}}
    \newcommand\@ZintervalCStar[2]{\ensuremath{\@interToolStar{\llbracket}{#1}{#2}{\rrbracket}}}

    \newcommand\ZintervalO{\@ifstar{\@ZintervalOStar}{\@ZintervalONoStar}}
    \newcommand\@ZintervalONoStar[2]{\ensuremath{\@interToolNoStar{\rrbracket}{#1}{#2}{\llbracket}}}
    \newcommand\@ZintervalOStar[2]{\ensuremath{\@interToolStar{\rrbracket}{#1}{#2}{\llbracket}}}

    \newcommand\ZintervalOC{\@ifstar{\@ZintervalOCStar}{\@ZintervalOCNoStar}}
    \newcommand\@ZintervalOCNoStar[2]{\ensuremath{\@interToolNoStar{\rrbracket}{#1}{#2}{\rrbracket}}}
    \newcommand\@ZintervalOCStar[2]{\ensuremath{\@interToolStar{\rrbracket}{#1}{#2}{\rrbracket}}}

% Macros for intervals - END

\makeatother


% -------------------------- %
% -- ANALYSIS - CONSTANTS -- %
% -------------------------- %

% User's constants

\newcommand\ct[1]{%
    \IfStrEqCase{#1}{%
        {gamma}{\upgamma}%
        {pi}{\uppi}%
        {tau}{\uptau}%
    }[\text{\textbf{#1}}]
}

% Classical constants
    
\newcommand\ggamma{\ct{gamma}}
\newcommand\ppi{\ct{pi}}
\newcommand\ttau{\ct{tau}}
\newcommand\ee{\ct{e}}
\newcommand\ii{\ct{i}}
\newcommand\jj{\ct{j}}
\newcommand\kk{\ct{k}}


% -------------------------- %
% -- ANALYSIS - FUNCTIONS -- %
% -------------------------- %

% Source for DeclareMathMacro :
%    * http://forum.mathematex.net/latex-f6/bonnes-commandes-de-base-t12278.html

% One useful tool

\makeatletter
    \newcommand\DeclareMathMacro[2]{%
        \expandafter\let\csname original@\expandafter\@gobble\string#1\endcsname=#1
        \expandafter\def\csname\expandafter\@gobble\string#1\endcsname{%
            \relax%
            \ifmmode#2%
            \else%
                \csname original@\expandafter\@gobble\string#1\expandafter\endcsname%
            \fi%
        }%
    }
\makeatother

% Classical functions

\DeclareMathMacro{\pgcd}{\operatorname{pgcd}}
\DeclareMathMacro{\ppcm}{\operatorname{ppcm}}
\DeclareMathMacro{\ch}{\operatorname{ch}}
\DeclareMathMacro{\sh}{\operatorname{sh}}
\DeclareMathMacro{\th}{\operatorname{th}}
\DeclareMathMacro{\ach}{\operatorname{ach}}
\DeclareMathMacro{\ash}{\operatorname{ash}}
\DeclareMathMacro{\ath}{\operatorname{ath}}
\DeclareMathMacro{\arccosh}{\operatorname{arccosh}}
\DeclareMathMacro{\arcsinh}{\operatorname{arcsinh}}
\DeclareMathMacro{\arctanh}{\operatorname{arctanh}}
\DeclareMathMacro{\acos}{\operatorname{acos}}
\DeclareMathMacro{\asin}{\operatorname{asin}}
\DeclareMathMacro{\atan}{\operatorname{atan}}

\newcommand\expb[1]{\exp_{#1}}
\newcommand\logb[1]{\log_{#1}}


% -------------------------- %
% -- ANALYSIS - SEQUENCES -- %
% -------------------------- %

\newcommand\suprageo[5]{ \prescript{#5}{#2}{#1}_{#3}^{#4} }

\newcommand\hypergeo[3]{%
    \suprageo{#1}{#2}{#3}{}{}%
}

\newcommand\seqplus[3]{%
    \suprageo{#1}{}{#2}{#3}{}%
}


% -------------------------------------- %
% -- ANALYSIS - DIFFERENTIAL CALCULUS -- %
% -------------------------------------- %

% Sources :
%    * http://forum.mathematex.net/latex-f6/en-tete-de-ds-t12933.html#p124908
%    * http://forum.mathematex.net/latex-f6/derivee-avec-un-d-droit-et-espace-t12932.html#p124930
%    * http://forum.mathematex.net/latex-f6/remplacer-des-espaces-par-autre-chose-t12952.html#p125062
%    * http://forum.mathematex.net/latex-f6/probleme-de-remplacement-de-cdots-t13047.html#p125782

\noexpandarg % This is necessary so as to '' \derfrac[3]{\cos}{x} ''  works.

\makeatletter
% dd, partial and pp usefull operators
    \newcommand{\@diffOpe}[3]{%
        #3%
        \IfStrEq{#1}{0}{}{^{#1}\!}%
        \IfBeginWith{#2}{f}{\!}{}%
        \hspace{0.07em}#2%
    }

    \DeclareRobustCommand\@dder{
        \mathop{}\mathopen{}\mathrm{d}
    }

    \newcommand\dd[2][0]{\@diffOpe{#1}{#2}{\@dder}}

    \let\original@partial\partial
    \renewcommand{\partial}{%
        \original@partial\mathopen{}%
    }

    \newcommand\pp[2][0]{\@diffOpe{#1}{#2}{\partial}}

% Power writing of total derivate
    \newcommand\derpow[2][\relax]{
        \IfStrEq{#1}{\relax}{
            #2^{\left( 1 \right)}
        }{
            #2^{\left( #1 \right)}
        }
    }

% Fractional writing of total derivate
	\newcommand\derfrac{\@ifstar{\@derfracStar}{\@derfracNoStar}}

    \newcommand\@derfracNoStar[3][\relax]{
        \IfStrEq{#1}{\relax}{
            \frac{\dd{#2}}{\dd{#3}}
        }{
            \frac{\dd[#1]{#2}}{\dd{#3}^{#1}}
        }
    }

    \newcommand\@derfracStar[3][\relax]{
    	\@derfracNoStar[#1]{}{#3} #2
    }

% Subscript writing of total derivate
    \newcommand\dersub[3][\relax]{
% The following command works because xstring traits {...} like a single character.
        \dd%
        \IfStrEq{#1}{\relax}{%
        	^{\vphantom{\prime}}%
        }{%
	        ^{#1}%
	    }%
	    _{#3} #2%
    }

% Subscript writing of partial derivate
    \newcommand\@bracketIt[1]{(#1)}

    \newcommand\partialsub[2]{
% The following command works because xstring traits {...} like a single character.
        \StrSubstitute{#2}{^}{\@bracketIt}[\@index]
        \partial%
        ^{\vphantom{\prime}}%
        _{\expandafter\StrSubstitute\expandafter{\@index}{//}{\,}}%
        #1%
    }

% Prime writing of partial derivate
    \newcommand\partialprime[2]{
% The following command works because xstring traits {...} like a single character.
        \StrSubstitute{#2}{^}{\@bracketIt}[\@index]%
        #1%
        ^{\prime}%
        _{\expandafter\StrSubstitute\expandafter{\@index}{//}{\,}}
    }

% Fractional writing of partial derivate
	\newcommand\partialfrac{\@ifstar{\@partialfracStar}{\@partialfracNoStar}}

    \newcommand\@partialfracNoStar[3][0]{%
        \frac{%
            \pp[#1]{#2}%
        }{%
            \StrSubstitute{\partial#3}{//}{\, \partial}[\@deno]%
            \expandafter\StrSubstitute\expandafter{\@deno}{\partial\cdots}{\,\cdots{}\,\partial}
        }
    }

    \newcommand\@partialfracStar[3][\relax]{
    	\@partialfracNoStar[#1]{}{#3} #2
    }
\makeatother


% ---------------------------------- %
% -- ANALYSIS - INTEGRAL CALCULUS -- %
% ---------------------------------- %

% Source for minimizing spaces between consecutive integrals :
%    * http://forum.mathematex.net/latex-f6/integrale-triple-t13312.html#p128016

% Consecutive integrals

\makeatletter
    \let\original@int\int
    \DeclareRobustCommand{\int}{%
        \original@int\operator@followup{\@ifnextchar{\int}{\!\!}{}}%
    }

    \def\operator@followup#1{%
        \@ifnextchar{^}{\operator@followup@sup{#1}}%
            {\operator@followup@nosup{#1}}%
    }

    \def\operator@followup@sup#1^#2{%
        \@ifnextchar{_}{\operator@followup@sup@sub{#1}^{#2}}%
            {\operator@followup@sup@nosub{#1}^{#2}}%
    }

    \def\operator@followup@sup@sub#1^#2_#3{%
        \operator@followup@{#1}{#2}{#3}%
    }

    \def\operator@followup@sup@nosub#1^#2{%
        \operator@followup@{#1}{#2}{}%
    }

    \def\operator@followup@nosup#1{%
        \@ifnextchar{_}{\operator@followup@nosup@sub{#1}}
            {\operator@followup@nosup@nosub{#1}}%
    }

    \def\operator@followup@nosup@sub#1_#2{%
        \@ifnextchar{^}{\operator@followup@nosup@sub@sup{#1}_{#2}}
            {\operator@followup@nosup@sub@nosup{#1}_{#2}}%
    }

    \def\operator@followup@nosup@sub@sup#1_#2^#3{%
        \operator@followup@{#1}{#3}{#2}%
    }

    \def\operator@followup@nosup@sub@nosup#1_#2{%
        \operator@followup@{#1}{}{#2}%
    }

    \def\operator@followup@nosup@nosub#1{%
        \operator@followup@{#1}{}{}%
    }

    \def\operator@followup@#1#2#3{%
        ^{#2}_{#3}#1%
    }

% The hook calculator
    \newcommand\hook{\@ifstar{\@hookStar}{\@hookNoStar}}
    \newcommand\@hookNoStar[3]{\ensuremath{ \left[ \vphantom{\relsize{1.25}{\text{$\displaystyle F_1^2$}}} \right. \!\! #1 \left. \vphantom{\relsize{1.25}{\text{$\displaystyle F_1^2$}}} \!\! \right]_{#2}^{#3} }}
    \newcommand\@hookStar[3]{\left[ \vphantom{\text{\relsize{1.1}$#1$}} #1 \right]_{#2}^{#3}}

    \newcommand\vhook{\@ifstar{\@vhookStar}{\@vhookNoStar}}
    \newcommand\@vhookNoStar[3]{#1 {\text{\relsize{1.5}$\rvert$}}_{#2}^{#3}}
    \newcommand\@vhookStar[3]{\left. #1 \right\rvert_{#2}^{#3}}

\makeatother


% ----------------------------------- %
% -- ANALYSIS - BIG SMALL O AND CO -- %
% ----------------------------------- %

% Sources :
%     1) http://forum.mathematex.net/latex-f6/bonnes-commandes-de-base-t12278.html
%     2) http://tex.stackexchange.com/questions/30944/mathcalo-and-font-size
%     3) https://tex.stackexchange.com/a/53091/6880

\makeatletter
    \newcommand\@bigtAsymptoricOpe[2]{%
        \ensuremath{%
            \if\relax\detokenize{#2}\relax
                #1%
            \else
                \mathop{}\mathopen{}#1\mathopen{}\left( #2 \right)%
            \fi
        }%
    }

    \newcommand\bigomega[1]{%
        \@bigtAsymptoricOpe{\bm{\Omega}}{#1}%
    }

    \newcommand\bigtheta[1]{%
        \@bigtAsymptoricOpe{\bm{\Theta}}{#1}%
    }

    \newcommand\bigO[1]{%
        \@bigtAsymptoricOpe{\mathcal{O}}{#1}%
    }

    \newcommand\smallO[1]{%
        \if\relax\detokenize{#1}\relax
            \mathchoice{% * Display style
                {\scriptstyle\mathcal{O}}%
            }{%           * Text style
                {\scriptstyle\mathcal{O}}%
            }{%           * Script style
                {\scriptscriptstyle\mathcal{O}}%
            }{%           * Script script style
                %\scalebox{0.8}{$\scriptscriptstyle\mathcal{O}$}%
            }
        \else
            \mathchoice{% * Display style
                \operatorname{\scriptstyle\mathcal{O}}\!\left(#1\right)%
            }{%           * Text style
                \operatorname{\scriptstyle\mathcal{O}}\!\left(#1\right)%
            }{%           * Script style
                \operatorname{\scriptscriptstyle\mathcal{O}}\left(#1\right)%
            }{%           * Script script style
                \operatorname{\scalebox{0.8}{$\scriptscriptstyle\mathcal{O}$}}\left(#1\right)%
            }
        \fi
    }
\makeatother


% ---------------------- %
% -- GEOMETRY - POINT -- %
% ---------------------- %

\newcommand\pt[1]{\mathrm{#1}}


% ----------------------- %
% -- GEOMETRY - VECTOR -- %
% ----------------------- %

\makeatletter
	\newcommand\vect{\@ifstar{\@vectStared}{\@vectUnstared}}
	\newcommand*\@vectStared[1]{\vv*{#1}}
	\newcommand*\@vectUnstared[1]{\vv{#1}}
\makeatother


% ---------------------- %
% -- GEOMETRY - ANGLE -- %
% ---------------------- %

% Source : http://forum.mathematex.net/latex-f6/arc-dont-le-nom-comporte-un-indice-t12392.html#p120204

\makeatletter
	\newcommand\anglein{\@ifstar{\@angleinStar}{\@angleinNoStar}}
	\newcommand*\@angleinStar[2]{\widehat{#1}\vphantom{#1}_{#2}}
	\newcommand*\@angleinNoStar[1]{\widehat{#1}}
\makeatother

%\newcommand\angleVect[2]{\left( #1 ; #2\right)} % STYLE


% -------------------- %
% -- GEOMETRY - ARC -- %
% -------------------- %

\makeatletter
	\newcommand\arc{\@ifstar{\@arcStared}{\@arcUnstared}}
	\newcommand*\@arcStared[2]{\wideparen{#1}\vphantom{#1}_{#2}}
	\newcommand*\@arcUnstared[1]{\wideparen{#1}}
\makeatother


% ------------------------------------- %
% -- ARITHMETIC - CONTINUED FRACTION -- %
% ------------------------------------- %

% Sources :
%    * https://groups.google.com/forum/?hl=fr&fromgroups#!topic/fr.comp.text.tex/UrUZiurKwm0
%    * http://tex.stackexchange.com/questions/68190/continued-fraction-in-inline-equations/68196#68196
%    * http://tex.stackexchange.com/questions/23432/how-to-create-my-own-math-operator-with-limits

\makeatletter
% Operator
	\newcommand\contfracope{%
		\operatornamewithlimits{%
			\mathchoice{% * Display style
				\vcenter{\hbox{\huge $\mathcal{K}$}}%
			}{%           * Text style
				\vcenter{\hbox{\Large $\mathcal{K}$}}%
			}{%           * Script style
				\mathrm{\mathcal{K}}%
			}{%           * Script script style
				\mathrm{\mathcal{K}}%
			}
		}
	}

% Single continued fraction (useful ?)
	\newcommand\singlecontfrac[2]{%
		\begin{array}{@{}c@{}}%
			\multicolumn{1}{c|}{#1}%
			\\%
			\hline%
			\multicolumn{1}{|c}{#2}%
		\end{array}%
	}

% Standard continued fraction
	\newcommand\contfrac{\@ifstar{\@contfracStar}{\@contfracNoStar}}
	
	\newcommand\@contfracNoStar[1]{%
		\@contfracNoStarRecu@#1//\@nil%
	}
	\def\@contfracNoStarRecu@#1//#2\@nil{%
		\@ifmtarg{#2}{%
			#1%
		}{%
			#1 + \cfrac{1}{\@contfracNoStarRecu@#2\@nil}%
		}%
	}	

	\newcommand\@contfracStar[1]{%
		\@contfracStarBefore@#1//\@nil%
	}
	\def\@contfracStarBefore@#1//#2\@nil{%
    	\@ifmtarg{#2}{%
        	#1%
        }{%
        	#1 \@contfracStarRecu@#2\@nil%
        }%
    }
    \def\@contfracStarRecu@#1//#2\@nil{%
    	\@ifmtarg{#2}{%
        	+ \singlecontfrac{1}{#1}%
        }{%
        	+ \singlecontfrac{1}{#1} \@contfracStarRecu@#2\@nil%
        }%
    }

% Generalized continued fraction
	\newcommand\contfracgene{\@ifstar{\@contfracgeneStar}{\@contfracgeneNoStar}}
	
	\newcommand\@contfracgeneNoStar[1]{%
		\@contfracgeneNoStarRecu@#1////\@nil%
	}
	\def\@contfracgeneNoStarRecu@#1//#2//#3\@nil{%
		\@ifmtarg{#2}{%
			#1%
		}{%
			#1 + \cfrac{#2}{\@contfracgeneNoStarRecu@#3\@nil}%
		}%
	}
	

	\newcommand\@contfracgeneStar[1]{%
		\@contfracgeneStarBefore@#1//\@nil%
	}
	\def\@contfracgeneStarBefore@#1//#2\@nil{%
    	\@ifmtarg{#2}{%
        	#1%
        }{%
        	#1 \@contfracgeneStarRecu@#2\@nil%
        }%
    }	
    \def\@contfracgeneStarRecu@#1//#2//#3\@nil{%
        \@ifmtarg{#3}{%
            + \singlecontfrac{#1}{#2}%
        }{%
            + \singlecontfrac{#1}{#2} \@contfracgeneStarRecu@#3\@nil%
        }%
    }
\makeatother